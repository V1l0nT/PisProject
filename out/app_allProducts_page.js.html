<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: app/allProducts/page.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: app/allProducts/page.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use client"; // Директива для указания, что это клиентский компонент

import { useState, useEffect } from "react";
import ProductCard from "../components/ProductCard";
import styles from "./allProducts.module.css";
import Cookies from "js-cookie";
import { useSearchParams } from "next/navigation";

/**
 * Компонент ProductsPage отображает список товаров выбранной категории.
 * Загружает товары с сервера в зависимости от параметра category из URL.
 * Требует авторизации пользователя (наличия токена в cookies).
 *
 * @component
 * @returns {JSX.Element|null} Разметка страницы с товарами или сообщения об авторизации/загрузке.
 */
export default function ProductsPage() {
  const searchParams = useSearchParams(); // Хук для получения параметров поиска
  const category = searchParams.get("category"); // Получаем значение параметра category

  /** @type {[Array&lt;Object>, Function]} products - список товаров */
  const [products, setProducts] = useState([]);
  /** @type {[boolean, Function]} loading - флаг загрузки данных */
  const [loading, setLoading] = useState(true);
  /** @type {[boolean, Function]} isClient - флаг рендера на клиенте */
  const [isClient, setIsClient] = useState(false);
  /** @type {string | undefined} token - токен авторизации из cookies */
  const token = Cookies.get("auth_token");

  useEffect(() => {
    setIsClient(true); // Обновляем флаг, когда компонент рендерится на клиенте

    /**
     * Асинхронная функция для загрузки товаров по категории.
     * Если категория не указана, товары не загружаются.
     */
    const fetchProducts = async () => {
      if (category) {
        try {
          const res = await fetch(`/api/allProducts?category=${category}`, {
            cache: "no-store",
          });
          if (!res.ok) {
            throw new Error(`Ошибка загрузки товаров: ${res.status}`);
          }
          const data = await res.json();
          setProducts(data);
        } catch (error) {
          console.error(error);
          setProducts([]);
        }
      }
      setLoading(false); // После загрузки данных меняем флаг загрузки
    };

    fetchProducts();
  }, [category]);

  // Не рендерим контент на сервере, чтобы избежать расхождений
  if (!isClient) {
    return null;
  }

  // Если пользователь не авторизован, показываем сообщение с просьбой авторизоваться
  if (!token) {
    return (
      &lt;div className={styles.PleaseSign}>
        Пожалуйста, авторизуйтесь, чтобы увидеть товары
      &lt;/div>
    );
  }

  // Пока данные загружаются, показываем индикатор загрузки
  if (loading) {
    return &lt;div>Загрузка...&lt;/div>;
  }

  return (
    &lt;div style={{ display: "flex", justifyContent: "center", width: "100%" }}>
      &lt;div
        style={{
          maxWidth: "1350px",
          width: "100%",
          display: "flex",
          flexDirection: "column",
          gap: "30px",
        }}
      >
        &lt;h2 style={{ textAlign: "center" }}>{category}&lt;/h2>
        &lt;div
          style={{
            display: "flex",
            flexWrap: "wrap",
            gap: "30px",
            justifyContent: "center",
          }}
        >
          {products.map((product) => (
            &lt;ProductCard key={product.id} product={product} />
          ))}
        &lt;/div>
      &lt;/div>
    &lt;/div>
  );
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#Cart">Cart</a></li><li><a href="global.html#CartContext">CartContext</a></li><li><a href="global.html#CartProvider">CartProvider</a></li><li><a href="global.html#Footer">Footer</a></li><li><a href="global.html#GET">GET</a></li><li><a href="global.html#Header">Header</a></li><li><a href="global.html#POST">POST</a></li><li><a href="global.html#down">down</a></li><li><a href="global.html#query">query</a></li><li><a href="global.html#up">up</a></li><li><a href="global.html#useCart">useCart</a></li><li><a href="global.html#verifyToken">verifyToken</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Wed Apr 23 2025 22:09:57 GMT+0300 (Москва, стандартное время)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
